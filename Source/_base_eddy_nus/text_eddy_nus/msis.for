c           M S I S - 77
c
      subroutine msis(z,fi,td,ap,fa,fs,tau,cn,pltn,tn)
      real n120
      dimension gk(45,6),am(6),alp(6),gg(6),cn(6),p(12)
      dimension gk1(45,2),gk2(45,2),gk3(45,2)
      data gk1
c
     */ 2.810e11, 8*0.    , 2.727e-3, 1.386e-3, 1.      , 1.      ,
     *  2*0.    , 6.702e-2, 0.      , 9.902e01,-1.200e-1, 0.      ,
     * -1.143e01, 12*0.   , 1.140e-3,-1.274e-3, 0.      ,-2.550e-2,
     *  7.381e-3, 7*0.    ,
c
     *  3.330e10, 0.      , 0.      , 0.      , 0.      , 0.      ,
     *  0.      , 0.      , 0.      ,-5.921e-3, 0.      , 1.      ,
     *  1.      ,-1.709e-1,-2.210e01,-2.177e-1, 0.      , 9.561e01,
     *  2.311e-1, 0.      ,-9.918e-1,-1.751e-1, 2.089e01,-1.428e-1,
     *  0.      , 0.      , 0.      , 0.      , 2.386e-1, 0.      ,
     *  0.      , 0.      , 0.      , 2.893e-2, 0.      ,-1.735e-2,
     * -3.051e-4, 0.      ,-3.371e-3, 0.      , 0.      , 0.      ,
     *  0.      , 0.      , 0.      /
      data gk2/
c
     *  1.761e05, 0.      ,-1.337e-1, 0.      ,-1.246e-2, 0.      ,
     * -1.930e-2, 0.      , 0.      ,-5.185e-3, 0.      , 1.      ,
     *  1.      , 5.878e-2, 9.227e01, 0.      , 0.      , 0.      ,
     *  3.301e-1, 1.045e-1,-1.477e01,-9.065e-2,-7.200e01, 2.094e-1,
     *  2.830e-2, 0.      , 8.571e-2,-2.475e-2, 3.830e-1, 2.941e-2,
     *  0.      ,-3.974e-3, 4.356e-2,12*0. ,
c
     *  8.594e10,-3.843e-2,-1.047e-1,-1.252e-1, 9.588e-4, 0.      ,
     *  2.261e-3, 1.892e-3, 2.160e-3,-9.342e-4,-3.275e-2, 6.640e-1,
     *  2.756e-1, 6.474e-2,-4.338e01, 1.370e-1, 0.      , 1.042e02,
     *  4.213e-1, 0.      ,-1.605e+1,-7.536e-2,-3.585e01,-9.341e-2,
     * -2.993e-2, 0.      , 0.      , 2.218e-2, 1.512e-1,-2.738e-2,
     *  0.      , 0.      , 2.918e-2,-1.027e-2, 0.      , 0.      ,
     * -1.693e-2, 0.      , 0.      , 0.      , 0.      ,-9.649e-1,
     * -1.132e00,-1.180e00, 2.005e-2/
      data gk3/
c
     *  2.456e07,-1.096e-1,-1.131e-1,-1.996e-1,-6.927e-4, 0.      ,
     *  0.      , 1.373e-4, 6.400e-3,-9.568e-3,-6.420e-2, 3.966e-1,
     *  1.938e-1,-1.145e-1,-1.810e02, 3.529e-1,-8.841e-2, 1.062e02,
     *  1.667e00, 2.531e-1,-7.336e00, 9.662e-2,-3.992e01,-2.629e-1,
     * -2.724e-2,-3.197e-2, 6.281e-2, 1.427e-1, 4.990e-1, 6.111e-3,
     * -3.449e-2,-2.774e-2, 1.314e-1, 3.704e-2, 0.      , 0.      ,
     * -3.829e-2, 0.      , 0.      , 0.      , 0.      , 0.      ,
     * -3.978e-1,-9.144e-1, 5.108e-2,
c
     *  1.330e09, 0.      , 0.      , 0.      ,-3.884e-3, 0.      ,
     *  0.      , 0.      , 0.      , 4.734e-3, 1.166e-2, 1.      ,
     *  1.      ,-6.419e-2, 6.173e01,-3.219e-2, 1.166e-1, 5.631e01,
     * -2.243e-1, 0.      , 8.403e00,-1.749e-1,-1.093e01,-6.430e-2,
     *  0.      , 0.      , 0.      , 1.108e-1,-5.089e-2, 0.      ,
     *  0.      , 0.      ,-9.228e-2,-1.720e-2, 0.      , 0.      ,
     * -6.486e-2, 0.      , 0.      , 0.      , 0.      , 0.      ,
     *  0.      , 0.      , 0.      /
      data
     *          am
     */ 28.,32.,1.,16.,4.,40./,
     *          alp
     */ 0.,0.,-0.4,0.,-0.4,0./
      do 1 i=1,2
        do 2 j=1,45
          gk(j,i)=gk1(j,i)
          gk(j,i+2)=gk2(j,i)
          gk(j,i+4)=gk3(j,i)
    2   continue
    1 continue
      g120=9.44663e-3
      om=6.2831848/365.
      re=6371.02
      w=6.2831848/24.
      tet=(1.-fi/90.)*1.5707962
      r=8.314e-3
      call polinm(tet,p)
      df=fa-fs
      dfs=fs-150.
      ap4=ap-4.
      wt=w*tau
      wt2=wt+wt
      wt3=wt*3.
      cwt=cos(wt)
      swt=sin(wt)
      call tempn(z,tau,w,om,td,p,fa,fs,ap,tn,tb,t120,s)
      sig=s+0.00015
      gam=g120/r/tb/sig
      a=1.-t120/tb
      aksi=(z-120.)*(re+120.)/(re+z)
      pr=aksi*sig
      pr1=(1.-a)/(1.-a*exp(-pr))
      do 4 i=1,6
        call formg(i,g,gk,z,om,td,p,wt2,wt3,swt,cwt,df,dfs,ap4)
        gg(i)=g
        n120=gk(1,i)*exp(gg(i)-1.)
        gamn=gam*am(i)
        d=pr1**(1.+alp(i)+gamn)*exp(-pr*gamn)
        cn(i)=n120*d
    4 continue
      pltn=0.
      do 5 i=1,6
        pltn=pltn+cn(i)*am(i)*1.66e-24
    5 continue
      return
      end
